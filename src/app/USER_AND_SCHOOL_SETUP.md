# User & School Management - Mobile App Guide

This document outlines the user authentication, school creation, and data management flows for the mobile application.

---

## **1. User Authentication**

The app uses Firebase Authentication for user management. The primary users are school administrators who will manage their respective schools.

### **A. User Signup (Account Creation)**

When a new administrator signs up, two things happen:

1.  A new user is created in **Firebase Authentication** with their email and password.
2.  A corresponding user profile document is created in Firestore to store additional user information.

#### **Firestore Data Structure for Users:**

*   **Path:** `/users/{userId}`
*   **Description:** Each document represents a single administrator user, where `{userId}` is the UID from Firebase Authentication.

```typescript
// Reference from src/types/user.ts
export interface UserProfile {
  uid: string; // The Firebase Auth UID
  email: string | null;
  displayName: string | null;
  photoURL?: string | null;
  createdAt: Timestamp | string; // Firebase Timestamp or ISO string
}
```

#### **Implementation Steps:**

1.  **UI:** Create a signup form with fields for Full Name, Email, and Password.
2.  **Firebase SDK:** Use the `createUserWithEmailAndPassword` method from the Firebase Auth SDK.
3.  **Create Profile:** Upon successful user creation, retrieve the `user` object. Use its `uid` to create a new document in the `/users` collection with the data from the `UserProfile` interface. Use `serverTimestamp()` for the `createdAt` field.

---

## **2. User Login**

Existing administrators will log in using their email and password.

#### **Implementation Steps:**

1.  **UI:** Create a login form with fields for Email and Password.
2.  **Firebase SDK:** Use the `signInWithEmailAndPassword` method.
3.  **Session Management:** Once logged in, Firebase automatically manages the user's session. You can use an auth state listener to navigate the user to the appropriate screen (e.g., school selection).

---

## **3. School Creation**

A logged-in administrator can create one or more schools.

### **A. Firestore Data Structure for Schools**

*   **Path:** `/schools/{schoolId}`
*   **Description:** Each document represents a single school. The `{schoolId}` is a unique ID generated by Firestore.

```typescript
// A simplified version of the School interface from src/types/school.ts
export interface School {
  id: string; // The Firestore document ID
  name: string; // The official name of the school
  level: 'Primary' | 'Secondary' | 'Other'; // e.g., Primary
  district: string;
  // ... other school details

  // Crucially, this array links admins to the school
  adminUids: string[]; // Array containing the UIDs of all admins for this school
  createdBy: string; // UID of the admin who created the school
  createdAt: AppTimestamp;
  updatedAt: AppTimestamp;
}
```

### **B. Implementation Steps:**

1.  **UI:** Create a "Create New School" form with fields for all the necessary school information (Name, Level, District, etc.).
2.  **Get Current User:** Ensure an admin is logged in and get their `uid` from the Firebase Auth state.
3.  **Saving Data:**
    *   On form submission, use `addDoc` to create a new document in the `/schools` collection.
    *   In the new school document, set the `adminUids` field to be an array containing the current admin's `uid`: `[currentUser.uid]`.
    *   Set the `createdBy` field to the admin's `uid`.
    *   Set `createdAt` and `updatedAt` using `serverTimestamp()`.
4.  **Navigation:** After successfully creating the school, navigate the user to that school's dashboard, e.g., `/school/dashboard/{newSchoolId}`.

---

## **4. Fetching and Displaying Schools**

After an admin logs in, the app should display a list of schools they are authorized to manage.

#### **Implementation Steps:**

1.  **Get Current User:** Get the logged-in user's `uid`.
2.  **Query Firestore:**
    *   Create a query on the `/schools` collection.
    *   Use a `where` clause to find all documents where the `adminUids` array **contains** the current user's `uid`.
    *   The query would look like this: `query(collection(db, 'schools'), where('adminUids', 'array-contains', currentUser.uid))`
3.  **UI:**
    *   If the query returns one or more schools, display them in a list. Tapping a school should navigate to its dashboard (`/school/dashboard/{schoolId}`).
    *   If the query returns no schools, show a message prompting the admin to create their first school.